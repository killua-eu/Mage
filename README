Mage (Manage Gentoo) is a system for simple templated installation and
management of computers and clusters running Gentoo Linux. Mage is currently
pre-alpha, released under the GNU-GPLv3 license.

Project homepage: http://mage.vaizard.org/en/
Organization homepage: http://vaizard.org/

CONCEPT:
- Mage is (to be) a set of tools to manage single Gentoo boxes or clusters of
  (real/virtual) Gentoo boxes. Basically something like puppet only different ;)
- Used for
  * Bootstrapping:
    - Mage loads a configuration file describing a machine's intended usage
      (server, desktop, portable, embedded, etc.), required set of base software
      packages, kernel configuration and system configuration (Mage's config
      files can make the installer aware of its surroundings - i.e. how to fit
      in a network of computers with a given role)
    - Mage detects the boxes hardware, installs the base system, configures and
      installs the kernel, sets up the boxes configuration and boots into a
      readymade system.
  * Management: installing and configuring, updating and removing applications,
    locally and remotely [i.e. pssh or gearman?], managing roles within a
    cluster [binds with ganeti]
- Some of what mage does is automatic, some semiautomatic
- Packages are installed and configured in sets, roleaware (of packages - i.e.
  dovecot+postfix+postgrey+spamassassin, if mx master or backup)
- Performs incremental backups of machine state (/etc, list of installed
  packages, etc. - based on conf-update, maybe fillup/fillup-ng - 2011 gsoc)


DEVNOTES (please ignore):
conf-update: keeping track of CONFIG_PROTECT files never touched by user by
a) keeping checksums of revisions in a manifest
b) inotify rules over CONFIG_PROTECT dirs
conf-update handles
a) files not edited by users
b) files changed by mage during installation [i.e. using sed to change
   IP=0.0.0.0 to IP=192.168.1.100]
c) files edited by users

if b) is done via /etc/portage/bashrc
post_src_install() {
    mage-patch "${D}" # this line's wrong, just giving the general idea
                      # needs to look into portage bashrc hooks and variables
}

then, if mage wishes to perform changes, in the bashrc hook it would
apply own patches, replace strings or replace whole files.

then b=c from conf-updates point of view. if that cant be done this way then:

balicek instaluji poprve
1) emerge balicek
2) portage nainstaluje /etc/balicek.conf
3) mage schova nekam co nainstaloval portage, pak to v /etc sed-ne configurak
   nebo ten portageovskej nahradi vlastnim. hotovo.

balicek reinstaluji nebo updatuji
1) emerge balicek
2) portage nainstaluje /etc/._cfg0000_balicek.conf
3) mage porovna /etc/._cfg0000_balicek.conf s /var/mage/schovavacka/balicek.conf
   (diff). pak se pokusi tento diff aplikovat na /etc/balicek.conf [tim se
   osetri napr. to ze se treba zmeni komentare nebo se prida do konfiguraku
   nejaka drobnost], pokud to nejde, nahodi interakci
4) hotovo.
!! bod 3 hrozi ze se prida neco co se nema (upstream zmeni default config)

tedy, u balicku ktere si upravi sam uzivatel nebo mu je upravi mage, pricemz
typicka uprava bude treba nastaveni nejake LISTEN direktivy:
zmena IP=0.0.0.0 na IP=192.168.1.100.

v pripade mage uprav konfigu to neni problem, protoze mage proste vezme novou
verzi konfiguraku a upravi ji k obrazu svemu. takto upravena verze pak bude to
co bude conf-update porovnavat se starou verzi.

blbe to je v pripade, kdy se uzivatel dotkl souboru jakkoliv jinak nez magem a
neco si tam dopsal. klasika je ze to proste rucne odmergujes. co by se mi ale
libilo vice by bylo to, ze inotify hlidac po uzivatelske zmene bude mit
zazalohovany original i uzivatelem upravenou verzi. kdyz pak prijde nova verze
z portage, pak by mage umel udelat diff z originalu a uzivatelsky upravene verze
a tento diff by se pokusil aplikovat na novou upstream verzi.
kontrolu vysledku a pripadne nevyresene konflikty by pak nechal uzivateli na
doreseni. vim ze se na to budes divat asi krz prsty ale gentoo dava hodne zabrat
s tim jak tece na urovni konfiguraku. pokud by to byl problem, tak potom alespon
verzovani uzivatelem udelanych zmen pres inotify protoze dokurvit neco se da
velmi snadno :)

Stare (puvodni zadani) k conf-updatu: 
[1] ncurses rozhrani a colordiff (conf-update to ma)
[2] schopnost rozpoznat soubory ktere editoval uzivatel
- rozlisit je v rozhrani nejakym symbolem nebo odlisnou barvou
- moznost vybrat vsechny uzivatelem nikdy needitovane confy (tedy gentoo
  defaulty) a updatovat je
[3] support pro mergovani externi aplikaci (at uz ncurses nebo graficka)
[4] verzovani
- melo by mit frontend!
- revertni vse nebo vybrane neco k datu tomu a tomu
- k jednotlivemu souboru prohlizet diffy k ruznym revizim, moznost mergovat
- hlidani blizkosti preteceni / purgovani
[5] vyvrcholeni: verzovani uzivatelem menenych souboru - nejlepe dependence na
    incronu nebo necem takovem, nebo aspon user-invoked procesani CONFIG_PROTECT
    adresaru a ulozeni toho co jeste ulozeno neni
[6] vylepseny interaktivni mergovani (kde se krom rozdilu vlevo a vpravo da
    videt i okolostojici text ktery se nemeni) - toto je ale asi spis na nejakou
    separatni utilitku nebo nastaveni diffu ktere mozna existuje, ale nevim o
    nem
[7] mozna tomu celemu dat nove jmeno? ;)

* urcite pouzit na CONFIG_PROTECT promennou - rika kde jsou vsude narvany
konfiguracni soubory (tedy /etc, /usr/share/config atp.).
* princip, jak rozpoznat uzivatelem nikdy needitovane soubory: dvojim zpusobem.
  a) neprimo tim ze bych ke kazdemu souboru bych drzel checksumy revizi
  b) ale hlavne tim ze by se nad /etc (resp. vsemi CONFIG_PROTECT adresari)
     drzelo inotify pravidlo ktere by zalogovalo zmenu. kazda zmena by se pak
     zalogovala. a pokud by nebyla zparovana s aktivitou emerge/mage, tak by se
     soubor oznacil nejakym user-taint flagem

Q: moznost vybrat vsechny uzivatelem nikdy needitovane confy (gentoo/mage defs)
to se ma resit libovolna zmena? i treba zmena provedena nejakym toolem?
A: ano, libovolna zmena. neplati jen pro tooly portage a mage, vysvetleno vyse.
Q: u toho verzovani chces verzovat zvlast gentoo defaulty i vysledny konfigurak?
A: prijde mi ze nejlepsi je verzovat vse pohromade ale soubory, ktere jsou
   zmeneny jinak nez portage/mage, tedy i ty ktere vyplivne conf-update a budou
   se lisit od tech defaultu, tak tem bych nastavil nejaky user-edited flag.
Q: tedy pokud udelas zmenu z A do B a pak zpet do A, tak ti ulozi tri soubory
1.A  2.B   3.A, zatimco to, co popisujes ty, by udelalo jen dva soubory ..
A: uh? nerozumim.
Q: jak se budou resit casove znacky, bude stacit jen ciselny index s tim, ze se
necha casova znacka souboru nezmenena?
A: casove znacky ktereho souboru prosim?
